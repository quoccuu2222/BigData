<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>K·∫øt qu·∫£ ph√¢n t√≠ch</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>üìä K·∫øt qu·∫£ ph√¢n t√≠ch: {{ analysis_type }}</h1>
    
    {% if analysis_type == 'line_count' %}
        <h2>T·ªïng S·ªë D√≤ng</h2>
    {% elif analysis_type == 'word_count' %}
        <h2>Top 10 K·∫øt qu·∫£ Word Count</h2>
    {% elif analysis_type == 'avg_delay_by_origin' %}
        <h2>ƒê·ªô Tr·ªÖ ƒê·∫øn Trung B√¨nh theo S√¢n bay</h2>
    {% elif analysis_type == 'percentage_delayed_flights' %}
        <h2>T·ª∑ l·ªá Chuy·∫øn bay B·ªã Tr·ªÖ theo S√¢n bay</h2>
    {% elif analysis_type == 'delay_causes_breakdown' %}
        <h2>T·ª∑ tr·ªçng Nguy√™n nh√¢n ƒê·ªô tr·ªÖ (Carrier, Weather, NAS, Security, Late Aircraft)</h2>
    
    {% elif analysis_type == 'feature_importance_analysis' %}
        <h2>Ph√¢n t√≠ch T·ªïng quan v·ªÅ ƒê·ªô tr·ªÖ</h2>
        
    {% elif analysis_type == 'delay_prediction' %}
        <h2>D·ª± ƒëo√°n ƒê·ªô tr·ªÖ & Nguy√™n nh√¢n cho m·ªôt B·∫£n ghi</h2>
        
        {% if prediction_data %}
            <div style="border: 2px solid #007bff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3>‚≠ê So s√°nh D·ª± ƒëo√°n v√† Th·ª±c t·∫ø: {{ prediction_data.match_status }}</h3>
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f0f0f0;">
                            <th style="padding: 10px;">Ch·ªâ ti√™u</th>
                            <th style="padding: 10px;">D·ª± ƒëo√°n M√¥ h√¨nh (XGBoost)</th>
                            <th style="padding: 10px;">Th·ª±c t·∫ø (Data G·ªëc)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 10px; font-weight: bold;">Tr·∫°ng th√°i Tr·ªÖ (Delay)</td>
                            <td style="padding: 10px; color: {% if 'C√ì KH·∫¢ NƒÇNG B·ªä TR·ªÑ' in prediction_data.delay_prediction %}red{% else %}green{% endif %}; font-weight: bold;">{{ prediction_data.delay_prediction }} ({{ prediction_data.delay_probability }})</td>
                            <td style="padding: 10px; color: {% if 'TR·ªÑ TH·ª∞C T·∫æ' in prediction_data.actual_status %}red{% else %}green{% endif %}; font-weight: bold;">{{ prediction_data.actual_status }} (ArrDelay: {{ prediction_data.actual_arr_delay }})</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; font-weight: bold;">Nguy√™n nh√¢n Tr·ªÖ</td>
                            <td style="padding: 10px;">{{ prediction_data.cause_prediction }}</td>
                            <td style="padding: 10px;">{{ prediction_data.actual_cause_detail | safe }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>D·ªØ li·ªáu ƒê·∫∑c tr∆∞ng (Features) d√πng ƒë·ªÉ D·ª± ƒëo√°n:</h3>
            <pre style="background: #e9ecef; padding: 10px; border-radius: 5px;">{{ prediction_data.processed_features }}</pre>

            <h3>B·∫£n ghi D·ªØ li·ªáu G·ªëc (D√≤ng ƒë·∫ßu ti√™n trong file):</h3>
            <pre style="white-space: pre-wrap; word-wrap: break-word; background: #eee; padding: 15px; border-radius: 5px;">
{{ prediction_data.original_raw_line }}
            </pre>

        {% else %}
            <p style="color: red;">Kh√¥ng c√≥ d·ªØ li·ªáu d·ª± ƒëo√°n ƒë·ªÉ hi·ªÉn th·ªã.</p>
        {% endif %}
        
    {% else %}
        <h2>K·∫øt qu·∫£ Ph√¢n t√≠ch</h2>
    {% endif %}

    {% if analysis_type == 'feature_importance_analysis' and (plot_base64.delay_rate_plot or plot_base64.delay_cause_plot) %}
        <div style="margin-top: 20px; text-align: center;">
            {% if plot_base64.delay_rate_plot %}
                <h3>Bi·ªÉu ƒë·ªì 1: T·ª∑ l·ªá Chuy·∫øn bay B·ªã tr·ªÖ</h3>
                <img src="{{ plot_base64.delay_rate_plot }}" alt="Bi·ªÉu ƒë·ªì T·ª∑ l·ªá Tr·ªÖ" style="max-width: 90%; height: auto; border: 1px solid #ccc; margin-bottom: 20px;">
            {% endif %}
            
            {% if plot_base64.delay_cause_plot %}
                <h3>Bi·ªÉu ƒë·ªì 2: T·ª∑ tr·ªçng Nguy√™n nh√¢n Tr·ªÖ</h3>
                <img src="{{ plot_base64.delay_cause_plot }}" alt="Bi·ªÉu ƒë·ªì Nguy√™n nh√¢n Tr·ªÖ" style="max-width: 90%; height: auto; border: 1px solid #ccc;">
            {% endif %}
            
            <br>
            <small>C√°c bi·ªÉu ƒë·ªì ƒë∆∞·ª£c t·∫°o b·∫±ng Matplotlib trong PySpark</small>
        </div>
    {% elif plot_base64 and analysis_type != 'feature_importance_analysis' %}
    <div style="margin-top: 20px; text-align: center;">
        <img src="{{ plot_base64 }}" alt="Bi·ªÉu ƒë·ªì k·∫øt qu·∫£ ph√¢n t√≠ch" style="max-width: 90%; height: auto; border: 1px solid #ccc;">
        <br>
        <small>Bi·ªÉu ƒë·ªì ƒë∆∞·ª£c t·∫°o b·∫±ng Matplotlib trong PySpark</small>
    </div>
    {% endif %}

    {% if analysis_type != 'delay_prediction' %}
        <h3>Chi ti·∫øt D·ªØ li·ªáu</h3>
        <pre style="white-space: pre-wrap; word-wrap: break-word; background: #eee; padding: 15px; border-radius: 5px;">
{% for line in lines %}
{{ line.strip() }}
{% endfor %}
        </pre>
    {% else %}
        <h3>Th√¥ng tin Log v√† Tr·∫°ng th√°i</h3>
        <pre style="white-space: pre-wrap; word-wrap: break-word; background: #f0f0f0; padding: 15px; border-radius: 5px;">
{% for line in lines %}
{{ line.strip() }}
{% endfor %}
        </pre>
    {% endif %}
    
    <a href="{{ url_for('analysis_form') }}">‚¨ÖÔ∏è Quay l·∫°i trang Ph√¢n t√≠ch</a> | 
    <a href="{{ url_for('browse') }}">üè† Quay l·∫°i trang ch√≠nh</a>
</body>
</html>